<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>House of Jin | 金咖啡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', 'Microsoft YaHei',"楷体", "KaiTi", sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background-color: #d2b48c;
            color: white;
            padding: 20px 0;
            text-align: center;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        nav ul li {
            margin: 0 15px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            font-size: 18px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        nav ul li a:hover {
            background-color: #5a3921;
        }
        
        .hero {
            background: url('images/bg.jpg') center/cover no-repeat;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #fff;
        }
        
        section {
            padding: 60px 0;
        }
        
        h2 {
            text-align: left;
            margin-bottom: 30px;
            color: #5a3921;
            font-size: 2.2rem;
        }
        
        .bilingual {
            margin-bottom: 40px;
        }
        
        .bilingual p {
            margin-bottom: 20px;
            line-height: 1.8;
        }
        
       .chinese {
            font-family: "楷体", "KaiTi", "STKaiti", serif;
        }
        
        .english {
            font-style: italic;
            color: #555;
            border-left: 3px solid #8B4513;
            padding-left: 15px;
            margin-top: 15px;
        }
        
        .menu-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }
        
        .menu-item {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .menu-item:hover {
            transform: translateY(-5px);
        }
        
        .menu-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .menu-item h3 {
            padding: 15px;
            text-align: center;
            color: #5a3921;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .gallery-item {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .gallery-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .gallery-item img:hover {
            transform: scale(1.05);
        }
        
        footer {
            background-color: #5a3921;
            color: white;
            text-align: center;
            padding: 30px 0;
            margin-top: 40px;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        
        .footer-section {
            margin: 15px;
            min-width: 200px;
        }
        
        /* Reservation Section Styles */
        #reservation {
            background-color: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin: 40px auto;
            max-width: 800px;
        }
        
        .reservation-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.full-width {
            grid-column: span 2;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #5a3921;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: #5a3921;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #3a2514;
        }
        
        .alert {
            padding: 15px;
            background-color: #f8d7da;
            color: #721c24;
            border-radius: 4px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .alert button {
            background-color: #721c24;
        }
        
        .success-message {
            padding: 15px;
            background-color: #d4edda;
            color: #155724;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        
        #currentCustomers {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
            margin-top: 30px;
            text-align: center;
        }
        
        .customer-count {
            font-size: 24px;
            font-weight: bold;
            color: #5a3921;
        }
        
        .update-time {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        
        .staff-note {
            margin-top: 20px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .reservation-form {
                grid-template-columns: 1fr;
            }
            
            .form-group.full-width {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <header>
        <div class="container">
            <nav>
                <ul>
                    <li><a href="#home">首页 / Home</a></li>
                    <li><a href="#about">关于我们 / About</a></li>
                    <li><a href="#menu">菜单 / Menu</a></li>
                    <li><a href="#gallery">环境 / Gallery</a></li>
                    <li><a href="#contact">联系我们 / Contact</a></li>
                    <li><a href="#reservation">在线订位 / Reservation</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Banner -->
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>金咖啡<br>House of Jin</h1>
            <p>传统与创新的融合 / Where Tradition Meets Innovation</p>
        </div>
    </section>

    <!-- About Us -->
    <section id="about" class="container">
        <h2>关于我们 / About Us</h2>
        <div class="bilingual">
            <div class="chinese">
                <p>三十年来，金井JinJing不仅是一家餐饮老店，更是我们家庭的根，是马来西亚无数人味蕾与回忆的交汇点。父母用汗水与坚持，在这间小店里煮出一代又一代人熟悉的味道，也传承了他们对食物、家庭与人情味的信念。</p>
                
                <p>如今，孩子长大了，把这份记忆继续延续。在不改变初心的前提下，将老店翻新成一间融合传统与现代的新式咖啡厅——金咖啡 House of Jing。</p>
                
                <p>这里有父母的精神，有家的温度，也有新的可能。我们希望，无论是熟悉的老街坊，还是慕名而来的年轻人，都能在这间店里，尝到记忆的味道，喝出文化的延续。</p>
                
                <p>三十年的味道，不只是餐桌上的香气，更是心里的一份牵挂。</p>
            </div>
            <div class="english">
                <p>For nearly 30 years, JinJing was more than just a restaurant — it was a home, a legacy, and a place where countless Malaysians found warmth in familiar flavors. Our parents dedicated their lives to this humble eatery, crafting meals rich with tradition, love, and community.</p>
                
                <p>Now, as the next generation, we carry that story forward. Without forgetting where we came from, we've transformed the old shop into a modern café — House of Jing.</p>
                
                <p>It's a space where the past meets the present. A place where the spirit of our parents lives on in every cup and every smile. Whether you're a long-time neighbor or a curious newcomer, we invite you to experience a taste of memory, and sip on heritage reborn.</p>
                
                <p>30 years of flavor — not just a taste, but a heartfelt connection across generations.</p>
            </div>
        </div>
    </section>

    <!-- Menu -->
    <section id="menu" class="container">
        <h2>菜单 / Menu</h2>
        
        <h3 style="text-align:center;margin:30px 0 20px;color:#5a3921;">饮品 / Drinks</h3>
        <div class="menu-gallery">
            <div class="menu-item">
                <img src="images/drinks/kopiice.jpg" alt="Kopi Ice">
                <h3>Kopi Ice<br>冰咖啡</h3>
            </div>
            <div class="menu-item">
                <img src="images/drinks/milolava.jpg" alt="Milo Lava">
                <h3>Milo Lava<br>美禄火山</h3>
            </div>
            <div class="menu-item">
                <img src="images/drinks/tehais.jpg" alt="Teh Ais">
                <h3>Teh Ais<br>冰茶</h3>
            </div>
        </div>
        
        <h3 style="text-align:center;margin:30px 0 20px;color:#5a3921;">食物 / Food</h3>
        <div class="menu-gallery">
            <div class="menu-item">
                <img src="images/food/coffeebean.jpg" alt="Coffee Bean Special">
                <h3>Coffee Bean Special<br>特调咖啡豆餐</h3>
            </div>
            <div class="menu-item">
                <img src="images/food/fishnchip.jpg" alt="Fish & Chips">
                <h3>Fish & Chips<br>炸鱼薯条</h3>
            </div>
            <div class="menu-item">
                <img src="images/food/localfood.jpg" alt="Local Delight">
                <h3>Local Delight<br>本地风味</h3>
            </div>
            <div class="menu-item">
                <img src="images/food/nasilemak.jpg" alt="Nasi Lemak">
                <h3>Nasi Lemak<br>椰浆饭</h3>
            </div>
            <div class="menu-item">
                <img src="images/food/western.jpg" alt="Western Set">
                <h3>Western Set<br>西式套餐</h3>
            </div>
        </div>
    </section>

    <!-- Gallery -->
    <section id="gallery" class="container">
        <h2>环境显示 / Gallery</h2>
        <div class="gallery-grid">
            <div class="gallery-item">
                <img src="images/gallery/interior1.jpg" alt="Cafe Interior">
            </div>
            <div class="gallery-item">
                <img src="images/gallery/interior2.jpg" alt="Dining Area">
            </div>
            <div class="gallery-item">
                <img src="images/gallery/interior3.jpg" alt="Coffee Bar">
            </div>
            <div class="gallery-item">
                <img src="images/gallery/interior4.jpg" alt="Outdoor Seating">
            </div>
            <div class="gallery-item">
                <img src="images/gallery/interior5.jpg" alt="Heritage Wall">
            </div>
            <div class="gallery-item">
                <img src="images/gallery/interior6.jpg" alt="Special Corner">
            </div>
        </div>
    </section>

    <!-- Reservation Section -->
    <section id="reservation" class="container">
        <h2>在线订位 / Table Reservation</h2>
        
        <div id="fullBookingAlert" class="alert" style="display:none;">
            <p>今日已满座 / <span class="english">We're fully booked today</span></p>
            <button id="joinWaitlist">加入等待名单 / Join Waitlist</button>
        </div>
        
        <div id="successMessage" class="success-message">
            <p>订位成功! 我们会尽快与您确认 / <span class="english">Reservation successful! We'll confirm with you shortly.</span></p>
        </div>
        
        <form id="bookingForm" class="reservation-form">
            <div class="form-group">
                <label for="name">姓名 / Name</label>
                <input type="text" id="name" name="name" required>
            </div>
            
            <div class="form-group">
                <label for="phone">电话 / Phone</label>
                <input type="tel" id="phone" name="phone" required>
            </div>
            
            <div class="form-group">
                <label for="date">日期 / Date</label>
                <input type="date" id="date" name="date" required>
            </div>
            
            <div class="form-group">
                <label for="time">时间 / Time</label>
                <select id="time" name="time" required>
                    <option value="">选择时间 / Select time</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="people">人数 / Number of People</label>
                <input type="number" id="people" name="people" min="1" max="20" required>
            </div>
            
            <div class="form-group">
                <label for="notes">备注 / Special Requests</label>
                <textarea id="notes" name="notes" rows="3"></textarea>
            </div>
            
            <div class="form-group full-width">
                <button type="submit">确认订位 / Confirm Reservation</button>
            </div>
        </form>
        
        <div id="liveAvailability">
            <h3>实时可订时段 / Available Slots</h3>
            <p>加载中... / <span class="english">Loading...</span></p>
        </div>
        
        <!-- Customer Count Display -->
        <div id="currentCustomers">
            <h3>当前顾客人数 / Current Customers</h3>
            <p>店内顾客: <span class="customer-count">0</span></p>
            <p class="update-time">最后更新: <span id="lastUpdated">--</span></p>
            <p class="staff-note">
                员工请在Google表格中更新人数<br>
                <span class="english">Staff please update count in Google Sheet</span>
            </p>
        </div>
    </section>
    
    <!-- Contact -->
    <section id="contact" class="container">
        <h2>联系我们 / Contact Us</h2>
        <div class="footer-content">
            <div class="footer-section">
                <h3>地址 / Address</h3>
                <p>123 Jalan Besar, Kuala Lumpur, Malaysia</p>
            </div>
            <div class="footer-section">
                <h3>营业时间 / Hours</h3>
                <p>每日 / Daily: 9:00 AM - 10:00 PM</p>
            </div>
            <div class="footer-section">
                <h3>联系方式 / Contact</h3>
                <p>电话 / Tel: +60 12-345 6789</p>
                <p>电邮 / Email: hello@houseofjin.com</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 金咖啡 House of Jin. 版权所有 / All rights reserved.</p>
            <p>传承三十年的味道 / 30 Years of Heritage Flavor</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
    // Configuration
    const API_URL = 'YOUR_DEPLOYED_WEB_APP_URL'; // Replace with your deployed GAS URL
    const POLL_INTERVAL = 15000; // 15 seconds refresh rate
    
    // DOM Elements
    const bookingForm = document.getElementById('bookingForm');
    const waitlistForm = document.getElementById('waitlistForm');
    const fullBookingAlert = document.getElementById('fullBookingAlert');
    const successMessage = document.getElementById('successMessage');
    const joinWaitlistBtn = document.getElementById('joinWaitlist');
    const availableSlotsEl = document.getElementById('liveAvailability').querySelector('p');
    const customerCountEl = document.querySelector('.customer-count');
    const lastUpdatedEl = document.getElementById('lastUpdated');
    
    // Initialize date picker (min date = today)
    document.getElementById('date').min = new Date().toISOString().split('T')[0];
    
    // Load initial data
    loadTimeSlots();
    loadCustomerCount();
    
    // Set up auto-refresh
    setInterval(loadTimeSlots, POLL_INTERVAL);
    setInterval(loadCustomerCount, POLL_INTERVAL);
    
    // Event listeners
    bookingForm.addEventListener('submit', handleReservation);
    document.getElementById('date').addEventListener('change', loadTimeSlots);
    
    // Load available time slots
    async function loadTimeSlots() {
        const dateInput = document.getElementById('date');
        const date = dateInput.value || new Date().toISOString().split('T')[0];
        
        try {
            // Show loading state
            availableSlotsEl.innerHTML = '加载中... / <span class="english">Loading...</span>';
            
            const response = await fetch(`${API_URL}?action=checkAvailability&date=${date}`);
            const data = await response.json();
            
            if (data.error) {
                availableSlotsEl.innerHTML = `错误: ${data.error} / <span class="english">Error: ${data.error}</span>`;
                return;
            }
            
            // Update available slots display
            if (data.availableSlots && data.availableSlots.length > 0) {
                availableSlotsEl.innerHTML = `
                    <strong>${data.availableSlots.join(' | ')}</strong> 
                    (剩余座位: ${data.remainingSeats || 0} / <span class="english">Seats left: ${data.remainingSeats || 0}</span>)
                `;
                fullBookingAlert.style.display = 'none';
                updateTimeDropdown(data.availableSlots);
            } else {
                availableSlotsEl.innerHTML = '已满座 / <span class="english">Fully booked</span>';
                fullBookingAlert.style.display = 'flex';
                updateTimeDropdown([]);
            }
        } catch (error) {
            availableSlotsEl.innerHTML = '无法加载数据 / <span class="english">Unable to load data</span>';
            console.error('Error loading time slots:', error);
        }
    }
    
    // Update time dropdown with available slots
    function updateTimeDropdown(availableSlots) {
        const timeSelect = document.getElementById('time');
        
        // Clear existing options except the first
        timeSelect.innerHTML = '<option value="">选择时间 / Select time</option>';
        
        // Add available slots
        if (availableSlots && availableSlots.length > 0) {
            availableSlots.forEach(slot => {
                const option = document.createElement('option');
                option.value = slot;
                option.textContent = slot;
                timeSelect.appendChild(option);
            });
        }
    }
    
    // Load current customer count
    async function loadCustomerCount() {
        try {
            const response = await fetch(`${API_URL}?action=getCustomerCount`);
            const data = await response.json();
            
            if (!data.error) {
                customerCountEl.textContent = data.count;
                
                if (data.updatedAt) {
                    const updated = new Date(data.updatedAt);
                    lastUpdatedEl.textContent = 
                        updated.toLocaleTimeString() + ' ' + updated.toLocaleDateString();
                }
            }
        } catch (error) {
            console.error('Error loading customer count:', error);
        }
    }
    
    // Handle reservation form submission
    async function handleReservation(e) {
        e.preventDefault();
        
        const formData = new FormData(bookingForm);
        const params = new URLSearchParams();
        
        for (const [key, value] of formData.entries()) {
            params.append(key, value);
        }
        
        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                body: params.toString() + '&action=makeReservation',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            });
            
            const data = await response.json();
            
            if (data.error) {
                alert(`订位失败 / Reservation failed: ${data.error}`);
            } else {
                // Show success message
                bookingForm.reset();
                successMessage.style.display = 'block';
                setTimeout(() => successMessage.style.display = 'none', 5000);
                
                // Reload availability
                loadTimeSlots();
            }
        } catch (error) {
            alert('网络错误 / Network error');
            console.error('Error submitting reservation:', error);
        }
    }
    </script>
</body>
</html>
